# 谈谈什么是 synchronized ？

`synchronized`是Java中的一个关键字，用于控制并发访问共享资源，以实现线程同步，防止多个线程同时访问同一段代码，造成数据不一致的问题。

`synchronized`关键字在Java早期版本中是一个重量级锁，因为它依赖于操作系统的Mutex Lock，而操作系统实现线程之间的切换需要从用户态转换到内核态，这个过程的时间成本相对较高。

然而，从Java 6开始，JVM对`synchronized`进行了大量的优化，如引入自旋锁、适应性自旋锁、锁消除、锁粗化、偏向锁、轻量级锁等技术，这些优化大大减少了锁操作的开销，提高了`synchronized`的效率。

偏向锁是一种针对加锁操作的优化，它的主要思想是，如果一个线程获得了锁，那么锁就进入偏向模式，此时记录下这个线程ID，当这个线程再次请求锁时，无需再做任何同步操作。这样就省去了大量有关锁申请的操作，从而提高了程序的运行效率。但是，如果有另一个线程请求这个锁，那么偏向模式就会被撤销。

然而，偏向锁并不是适用于所有场景，它增加了JVM的复杂性，并且并不是所有应用都能从中获得性能提升。因此，在JDK 15中，偏向锁被默认关闭，可以通过`-XX:+UseBiasedLocking`参数启用。在JDK 18中，偏向锁已经被彻底废弃，无法通过命令行参数打开。

总的来说，虽然`synchronized`在早期版本中效率较低，但是经过多年的优化，现在已经可以在实际项目中使用，而且在JDK源码和许多开源框架中都有大量使用。

# 如何使用 synchronized 关键字 ？

`synchronized`可以用于修饰方法或者作为代码块的前缀。当它修饰一个方法或者一个代码块的时候，可以保证在同一时刻，最多只有一个线程执行该段代码。

1. 修饰实例方法：作用于当前实例加锁，进入同步代码前要获得当前对象实例的锁。

   ```java
   public synchronized void method() {
       // 同步代码
   }
   ```

2. 修饰静态方法：也就是给当前类加锁，会作用于整个类，进入同步代码前要获得当前类的锁。

   ```java
   public static synchronized void method() {
       // 同步代码
   }
   ```

3. 修饰代码块：指定加锁对象，对给定对象加锁，进入同步代码前要获得给定对象的锁。

   ```java
   synchronized (object) {
       // 同步代码
   }
   ```

`synchronized`关键字可以保证被它修饰的方法或者代码块在任意时刻只能有一个线程访问，从而实现了线程的同步和防止了数据不一致的问题。但是，过度使用`synchronized`可能会导致性能问题，因为线程会被阻塞等待锁的释放。

# 构造方法可以用 synchronized 修饰么？

在Java中，构造方法不能使用`synchronized`关键字修饰。

原因是，构造方法是用于初始化新创建的对象的，直到构造方法完成，其他线程是无法看到这个对象的。因此，对构造方法进行同步是没有意义的，因为它只会被执行一次，且无法被多个线程同时访问。

> 如果想在创建对象时进行某种形式的同步，可能需要在静态工厂方法中使用`synchronized`关键字。



# synchronized 和 volatile 有什么区别？

1. `synchronized`是一个同步锁，它可以保证同一时刻只有一个线程可以访问被`synchronized`修饰的方法或代码块，从而实现线程的同步，防止数据不一致。`synchronized`可以保证原子性和可见性。

   ```java
   public synchronized void add() {
       this.count++;
   }
   ```

2. `volatile`是一个类型修饰符，它保证了共享变量的“可见性”。可见性的意思是当一个线程修改一个共享变量时，另外的线程能读到这个修改的值。如果共享变量被`volatile`修饰，那么在每次数据变化后，其值都会被强制刷新到主内存，每次使用前都会从主内存刷新。但是`volatile`不能保证复合操作的原子性。

   ```java
   public volatile int count = 0;
   ```

总结一下，`synchronized`和`volatile`的主要区别如下：

- `synchronized`可以保证原子性和可见性，`volatile`只能保证可见性。
- `synchronized`会导致线程阻塞，`volatile`不会。
- `synchronized`可以修饰方法和代码块，`volatile`只能修饰字段。